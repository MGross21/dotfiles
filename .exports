# Environment
export EDITOR="nvim"
export SUDO_PROMPT="${(L)USER} password: "
export PAGER="less"
export LESS='-R -i -w -M -z-4'

export ANDROID_SDK_ROOT="/opt/android-sdk"

# PATH sourcing
if [[ -f "$HOME/.paths" ]]; then
    while IFS= read -r dir; do
        dir=${(e)dir}
        [[ -d "$dir" ]] && PATH="$dir:$PATH"
    done < "$HOME/.paths"
    typeset -U PATH
    export PATH
fi

# Colors
if command -v vivid &>/dev/null; then
    theme="tomorrow-night-burns"
    if [[ "$TERM" == "linux" ]]; then
        export LS_COLORS="$(vivid -m 8-bit generate "$theme")"
    else
        export LS_COLORS="$(vivid generate "$theme")"
    fi
fi

# Terminal TERM adjustments for compatibility
if [[ -n "$TMUX" ]]; then
    export TERM=tmux-256color
elif [[ "$TERM" == "xterm" ]] || [[ "$TERM" == "xterm-color" ]]; then
    export TERM=xterm-256color
fi

# Enable color output where applicable
export CLICOLOR=1
export COLORTERM=truecolor

# Firefox (Wayland)
if [[ "$XDG_SESSION_TYPE" == "wayland" ]]; then
    export MOZ_DBUS_REMOTE=1
    export MOZ_ENABLE_WAYLAND=1
    export MOZ_GTK_TITLEBAR_DECORATION=client
    export MOZ_DISABLE_SPLASH=1
fi

# FZF
if command -v fzf &>/dev/null; then
    export FZF_DEFAULT_COMMAND='fd --type f --hidden --follow --exclude .git'
    export FZF_DEFAULT_OPTS="--height=40% --layout=reverse --border --color=fg:#a1b0b8,bg:#151515,hl:#fc595f --color=fg+:#f5f5f5,bg+:#252525,hl+:#df9395 --color=info:#fc595f,prompt:#832e31,pointer:#a63c40,marker:#d3494e,spinner:#ba8586,header:#5d6f71"
    
    if command -v bat &>/dev/null; then
        export FZF_CTRL_T_OPTS="--preview 'bat --style=numbers --color=always --line-range :100 {}' --bind 'ctrl-/:toggle-preview'"
    fi
    
    export FZF_CTRL_R_OPTS="--preview 'echo {}' --preview-window=up:3"
    
    if command -v tree &>/dev/null; then
        export FZF_ALT_C_OPTS="--preview 'tree -C {} | head -50'"
    fi
fi